# Extracting Variable Regions from Nanopore Reads

This code is designed to extract variable regions from Oxford Nanopore reads. Given the nucleotide sequences that flank each region, it uses a blast search to identify the location of each variable region in each read. It then extracts the regions, translates them, and writes them to an output file.

For QC purposes, the code also keeps track of the number of reads that it successfully processes.

### Environment

Everything happens in a single project directory. The following subdirectories are used to keep all of the files organized.

| Directory | Description |
| --- | --- |
| `blastdb/` | databases of flanking regions that the reads are blasted against |
| `files/` | raw fasta files, blast outputs, and other files generated by the code |
| `logs/` | log files from the slurm jobs |
| `pythonfiles/` | python files used for processing the data |

All of the code is run through `extract.sh`.

### To Do

1. Unpack this zip file, copy the folder onto Garibaldi
2. Give the job a descriptive name in `extract.sh`
3. Adjust the number of arrays requested in `extract.sh` (typically 1-n, where n is the number of libraries being analyzed)
4. Add the names of the libraries to the variable “libraries” in `extract.sh`
5. Move the library fasta files to the `files/` directory. Make sure that the file names end in “_assembled.fasta”
6. Specify the input and pythonfile directories in `extract.sh`
7. Collect the flanking regions into a single file (`blastdb/flanking_regions.fasta`)
    1. Name the regions `>(name)_5prime-(length)` or `>(name)_3prime`. Everything before the first underscore is used as the name of the variable region in the final output file. The length is pulled as the value after the first dash in the name of the 5 prime flanking region. For instances where there are multiple possible lengths, separate them with commas.
    2. Regions can be any length. Shorter lengths will run faster. Lengths longer than 8nt don’t increase the number of reads that are successfully processed ([24-12-02 BLAST Strategy Speedtest](https://www.notion.so/24-12-02-BLAST-Strategy-Speedtest-151e5b183a4c809f8383e27a30bd3221?pvs=21))
8. Specify the number of regions in `extract.sh`
9. Run